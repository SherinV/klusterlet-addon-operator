# Licensed Materials - Property of IBM
# IBM Confidential
# OCO Source Materials
# (C) Copyright IBM Corporation 2016, 2019 All Rights Reserved
# The source code for this program is not published or otherwise divested of its trade secrets, irrespective of what has been deposited with the U.S. Copyright Office.

apiVersion: v1
kind: ConfigMap
metadata:
  labels:
    app: {{ template "mongodb-replicaset.name" . }}
    chart: {{ template "mongodb-replicaset.chart" . }}
    heritage: {{ .Release.Service }}
    release: {{ .Release.Name }}
  name: {{ template "mongodb-replicaset.fullname" . }}
data:
  mongod.conf: |
    storage:
      dbPath: /data/db
      wiredTiger:
        engineConfig:
          cacheSizeGB: {{ .Values.wiredTigerCacheSizeGb }}
    net:
{{- if eq  .Values.network_ip_version "ipv6" }}
      ipv6: true
{{- end }}
      bindIpAll: true
      port: {{ .Values.port }}
{{- if .Values.tls.enabled }}
      ssl:
        mode: requireSSL
        CAFile: /data/configdb/tls.crt
        PEMKeyFile: /work-dir/mongo.pem
{{- end }}
    replication:
      replSetName: {{ .Values.replicaSet }}
    # Uncomment for TLS support or keyfile access control without TLS
{{- if or .Values.tls.enabled .Values.auth.enabled}}
    security:
      authorization: enabled
      keyFile: /data/configdb/key.txt
{{- end }}
