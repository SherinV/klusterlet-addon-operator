{{- if .Values.tillerIntegration.enabled }}
apiVersion: admissionregistration.k8s.io/v1beta1
kind: ValidatingWebhookConfiguration
metadata:
  name: helm-crd-admission-controller-cfg
  labels:
    app: helm-crd-admission-controller
webhooks:
  - name: user-check.ibm.com
    clientConfig:
      service:
        namespace: "{{ .Release.Namespace }}"
        name: helm-crd-admission-controller-svc
        path: "/validate"
      caBundle: "{{ .Values.helmCRDAdmissionController.caBundle }}"
    failurePolicy: Fail
    rules:
      - operations: [ "*" ]
        apiGroups: ["*"]
        apiVersions: ["*"]
        resources: ["helmreleases"]
        scope: "*"
{{- end }}